# èƒœç‡ç®—æ³•æ”¹è¿›æ–‡æ¡£

## ğŸ“Œ æ”¹è¿›æ¦‚è¿°

åŸºäº Apex Liquid Bot ç®—æ³•çš„ä¼˜ç‚¹ï¼Œä¼˜åŒ–äº†é¡¹ç›®çš„èƒœç‡è®¡ç®—æ–¹æ³•ï¼Œä½¿å…¶æ›´ç¬¦åˆäº¤æ˜“åˆ†æè¡Œä¸šæ ‡å‡†ã€‚

---

## ğŸ” æ ¸å¿ƒæ”¹è¿›

### æ”¹è¿›å‰ï¼ˆæ—§ç®—æ³•ï¼‰
```python
# é—®é¢˜ï¼šå°†æ‰€æœ‰äº¤æ˜“ï¼ˆåŒ…æ‹¬é›¶PNLï¼‰è®¡å…¥åˆ†æ¯
winning_trades = sum(1 for fill in fills if _get_pnl(fill) > 0)
win_rate = (winning_trades / len(fills)) * 100  # âŒ ä¸åˆç†
```

### æ”¹è¿›åï¼ˆæ–°ç®—æ³•ï¼‰
```python
# æ­£ç¡®ï¼šåªç»Ÿè®¡æœ‰ç›ˆäºçš„äº¤æ˜“
winning_trades = 0
total_pnl_trades = 0

for fill in fills:
    pnl = _get_pnl(fill)
    if pnl != 0:  # æ’é™¤é›¶PNLäº¤æ˜“
        total_pnl_trades += 1
        if pnl > 0:
            winning_trades += 1

win_rate = (winning_trades / total_pnl_trades) * 100  # âœ… åˆç†
```

---

## ğŸ“Š ç®—æ³•å·®å¼‚å¯¹æ¯”

| ç»´åº¦ | æ—§ç®—æ³• | æ–°ç®—æ³• | å½±å“ |
|------|--------|--------|------|
| **åˆ†æ¯å®šä¹‰** | æ‰€æœ‰äº¤æ˜“è®°å½• | åªæœ‰ç›ˆäºçš„äº¤æ˜“ | **å…³é”®å·®å¼‚** |
| **é›¶PNLå¤„ç†** | ç®—ä½œå¤±è´¥äº¤æ˜“ | **æ’é™¤ä¸è®¡** | èƒœç‡å¯èƒ½å·®å¼‚10-30% |
| **ç¬¦åˆæ ‡å‡†** | ä¸ç¬¦åˆè¡Œä¸šæ ‡å‡† | ç¬¦åˆApex Liquid Botç­‰å¹³å° | æ›´å‡†ç¡® |

---

## ğŸ’¡ ä¸ºä»€ä¹ˆé›¶PNLä¸åº”è®¡å…¥ï¼Ÿ

é›¶PNLäº¤æ˜“é€šå¸¸æ˜¯ï¼š
- âœ… **å¼€ä»“äº¤æ˜“**ï¼šæ²¡æœ‰å¹³ä»“ï¼Œæ— å·²å®ç°ç›ˆäºï¼ˆclosedPnl = 0ï¼‰
- âœ… **éƒ¨åˆ†å¹³ä»“**ï¼šåªæ˜¯ä»“ä½è°ƒæ•´ï¼Œä¸æ˜¯å®Œæ•´äº¤æ˜“
- âœ… **æ‰‹ç»­è´¹æŠµæ¶ˆ**ï¼šå¾®å°ç›ˆåˆ©è¢«æ‰‹ç»­è´¹å®Œå…¨æŠµæ¶ˆ

**å°†è¿™äº›ç®—ä½œ"å¤±è´¥äº¤æ˜“"æ˜¾ç„¶ä¸åˆç†ï¼**

---

## ğŸ“ˆ å®é™…æ¡ˆä¾‹å¯¹æ¯”

### æµ‹è¯•æ•°æ®
```python
fills = [
    {'closedPnl': 100},   # ç›ˆåˆ©
    {'closedPnl': -50},   # äºæŸ
    {'closedPnl': 0},     # é›¶PNLï¼ˆå¼€ä»“ï¼‰
    {'closedPnl': 0},     # é›¶PNLï¼ˆå¼€ä»“ï¼‰
    {'closedPnl': 200},   # ç›ˆåˆ©
]
```

### è®¡ç®—ç»“æœ

| ç®—æ³• | è®¡ç®—æ–¹å¼ | èƒœç‡ | å·®å¼‚ |
|------|----------|------|------|
| **æ—§ç®—æ³•** | 2ç›ˆåˆ© / 5æ€»æ•° | **40.0%** | - |
| **æ–°ç®—æ³•** | 2ç›ˆåˆ© / 3æœ‰æ•ˆ | **66.7%** | **+26.7%** |

---

## ğŸ¯ æ–°å¢åŠŸèƒ½

### 1. æ”¹è¿›çš„èƒœç‡è®¡ç®—
```python
@staticmethod
def calculate_win_rate(fills: List[Dict]) -> float:
    """
    è®¡ç®—èƒœç‡ï¼ˆæ”¹è¿›ç‰ˆï¼šæ’é™¤é›¶PNLäº¤æ˜“ï¼‰

    Returns:
        èƒœç‡ç™¾åˆ†æ¯” (0-100)
    """
    # åªç»Ÿè®¡æœ‰ç›ˆäºçš„äº¤æ˜“
    winning_trades = 0
    total_pnl_trades = 0

    for fill in fills:
        pnl = MetricsEngine._get_pnl(fill)
        if pnl != 0:  # æ’é™¤é›¶PNL
            total_pnl_trades += 1
            if pnl > 0:
                winning_trades += 1

    if total_pnl_trades == 0:
        return 0.0

    win_rate = (winning_trades / total_pnl_trades) * 100
    return max(0.0, min(100.0, win_rate))
```

### 2. è¯¦ç»†ç»Ÿè®¡æ–¹æ³•ï¼ˆå¢å¼ºç‰ˆï¼‰
```python
@staticmethod
def calculate_win_rate_detailed(fills: List[Dict]) -> Dict[str, float]:
    """
    æä¾›æ›´å…¨é¢çš„äº¤æ˜“åˆ†ææ•°æ®

    Returns:
        {
            'win_rate': èƒœç‡ç™¾åˆ†æ¯”,
            'total_trades': æ€»äº¤æ˜“æ•°,
            'winning_trades': ç›ˆåˆ©äº¤æ˜“æ•°,
            'losing_trades': äºæŸäº¤æ˜“æ•°,
            'zero_pnl_trades': é›¶PNLäº¤æ˜“æ•°,
            'avg_win': å¹³å‡ç›ˆåˆ©é‡‘é¢,
            'avg_loss': å¹³å‡äºæŸé‡‘é¢,
            'profit_factor': ç›ˆäºæ¯”ï¼ˆæ€»ç›ˆåˆ©/æ€»äºæŸï¼‰
        }
    """
```

---

## âœ… æµ‹è¯•ç»“æœ

### æµ‹è¯•1ï¼šèƒœç‡ç®—æ³•æ”¹è¿›å¯¹æ¯”
```
æ€»äº¤æ˜“æ•°: 5 ç¬”
  - ç›ˆåˆ©äº¤æ˜“: 2 ç¬”
  - äºæŸäº¤æ˜“: 1 ç¬”
  - é›¶PNLäº¤æ˜“: 2 ç¬”ï¼ˆå¼€ä»“/éƒ¨åˆ†å¹³ä»“ï¼‰

èƒœç‡è®¡ç®—:
  - æ—§ç®—æ³•ï¼ˆé”™è¯¯ï¼‰: 2/5 = 40.0%
  - æ–°ç®—æ³•ï¼ˆæ­£ç¡®ï¼‰: 2/3 = 66.7%
  - å·®å¼‚: 26.7%

ç›ˆäºåˆ†æ:
  - å¹³å‡ç›ˆåˆ©: $150.00
  - å¹³å‡äºæŸ: $50.00
  - ç›ˆäºæ¯”: 6.00
```

---

## ğŸš€ æ”¹è¿›æ”¶ç›Š

1. **æ›´å‡†ç¡®çš„èƒœç‡ç»Ÿè®¡**ï¼šç¬¦åˆäº¤æ˜“åˆ†æè¡Œä¸šæ ‡å‡†
2. **æ›´å¤šç»Ÿè®¡ä¿¡æ¯**ï¼šç›ˆäºæ¯”ã€å¹³å‡ç›ˆäºç­‰
3. **æ›´å¥½çš„ä»£ç æ–‡æ¡£**ï¼šè¯¦ç»†çš„ç®—æ³•è¯´æ˜å’Œç¤ºä¾‹
4. **å‘åå…¼å®¹**ï¼šä¿æŒåŸæœ‰APIä¸å˜ï¼ˆè¿”å›å€¼ä»ä¸ºfloatï¼‰

---

## ğŸ“š å‚è€ƒæ¥æº

- **Apex Liquid Bot ç®—æ³•**ï¼šhttps://apexliquid.bot/
- **Hyperliquid API æ–‡æ¡£**ï¼šhttps://hyperliquid.gitbook.io/hyperliquid-docs/for-developers/api
- **è¡Œä¸šæ ‡å‡†**ï¼šå¤§å¤šæ•°äº¤æ˜“å¹³å°çš„èƒœç‡ç»Ÿè®¡åªè®¡ç®—å·²å¹³ä»“ä¸”æœ‰ç›ˆäºçš„äº¤æ˜“

---

## ğŸ”§ ä½¿ç”¨æ–¹å¼

### åŸºç¡€ä½¿ç”¨ï¼ˆä¸ä¹‹å‰ç›¸åŒï¼‰
```python
from address_analyzer.metrics_engine import MetricsEngine

win_rate = MetricsEngine.calculate_win_rate(fills)
print(f"èƒœç‡: {win_rate:.1f}%")  # ç°åœ¨æ›´å‡†ç¡®ï¼
```

### è¯¦ç»†ç»Ÿè®¡ï¼ˆæ–°åŠŸèƒ½ï¼‰
```python
detailed = MetricsEngine.calculate_win_rate_detailed(fills)
print(f"èƒœç‡: {detailed['win_rate']:.1f}%")
print(f"ç›ˆåˆ©äº¤æ˜“: {detailed['winning_trades']} ç¬”")
print(f"äºæŸäº¤æ˜“: {detailed['losing_trades']} ç¬”")
print(f"é›¶PNLäº¤æ˜“: {detailed['zero_pnl_trades']} ç¬”")
print(f"ç›ˆäºæ¯”: {detailed['profit_factor']:.2f}")
```

---

## âœ¨ æ€»ç»“

é€šè¿‡å€Ÿé‰´ Apex Liquid Bot çš„ä¼˜ç§€ç®—æ³•ï¼Œæˆ‘ä»¬çš„èƒœç‡è®¡ç®—ç°åœ¨ï¼š
- âœ… æ›´ç¬¦åˆäº¤æ˜“åˆ†ææ ‡å‡†
- âœ… æ’é™¤é›¶PNLäº¤æ˜“çš„å¹²æ‰°
- âœ… æä¾›æ›´å¤šæœ‰ä»·å€¼çš„ç»Ÿè®¡ä¿¡æ¯
- âœ… ä¿æŒAPIå‘åå…¼å®¹

**è¿™æ˜¯ä¸€ä¸ªé‡è¦çš„æ”¹è¿›ï¼Œä½¿å¾—é¡¹ç›®çš„äº¤æ˜“åˆ†ææ›´åŠ ä¸“ä¸šå’Œå‡†ç¡®ï¼** ğŸ‰
